**USER**

நான் இந்தத் திட்டத்தில் Node.js மற்றும் MongoDB stack-ஐ ஆரம்பத்திலிருந்து பயன்படுத்தக் கற்றுக்கொண்டு வருகிறேன்.
ஆகவே, நாம் "native MongoDB queries"-ஐ பயன்படுத்தி இந்த செயலியை உருவாக்கக்கூடாது என்று நினைக்கிறேன்.

**RESPONSE**

நிச்சயமாக, இது ஒரு மிகச் சிறந்த கற்றல் அணுகுமுறை! Mongoose போன்ற ODM (Object Data Modeling) கருவிகளைத் தவிர்த்துவிட்டு, நேரடியாக நேட்டிவ் MongoDB டிரைவரைப் பயன்படுத்துவது, Node.js மற்றும் MongoDB எப்படி पर्देக்குப் பின்னால் வேலை செய்கின்றன என்பதை ஆழமாகப் புரிந்துகொள்ள உதவும்.

உங்கள் கற்றல் நோக்கத்திற்கு இது சரியான பாதை. நாம் இந்தத் திட்டத்தை நேட்டிவ் MongoDB வினவல்கள் (queries) மூலமாகவே உருவாக்குவோம்.

### Mongoose vs நேட்டிவ் MongoDB டிரைவர்: ஒரு விரைவான ஒப்பீடு

| அம்சம் | Mongoose (ODM) | நேட்டிவ் MongoDB டிரைவர் |
| :--- | :--- | :--- |
| **அணுகுமுறை** | இது ஒரு अमूर्त அடுக்கு (Abstraction Layer). தரவு மாதிரிகளை (Models) மற்றும் ஸ்கீமாக்களை (Schemas) உருவாக்குகிறது. | நேரடியாக MongoDB உடன் தொடர்பு கொள்ளும். முழுமையான கட்டுப்பாட்டைக் கொடுக்கும். |
| **ஸ்கீமா** | கட்டாயப்படுத்தப்பட்ட ஸ்கீமா (Enforced Schema). தரவின் அமைப்பு முன்பே வரையறுக்கப்படும். | ஸ்கீமா இல்லாதது (Schema-less). தரவை எப்படி வேண்டுமானாலும் சேமிக்கலாம். |
| **பயன்பாடு** | தொடங்குவதற்கு எளிமையானது. உள்ளமைக்கப்பட்ட சரிபார்ப்புகள் (validations) மற்றும் Middleware-கள் உண்டு. | MongoDB-ஐப் பற்றிய ஆழமான புரிதல் தேவை. சரிபார்ப்புகளை நீங்களே கையாள வேண்டும். |
| **கற்றல்** | MongoDB இன் அடிப்படைகளை மறைத்துவிடும். | MongoDB இன் ஒவ்வொரு செயல்பாட்டையும் (CRUD) நேரடியாகக் கற்றுக்கொள்ளச் சிறந்தது. |

உங்கள் விருப்பப்படி, நாம் **நேட்டிவ் MongoDB டிரைவரைப்** பயன்படுத்துவோம்.

---

### திருத்தப்பட்ட படிநிலைகள் (Revised Roadmap with Native Driver)

**Phase 1: கட்டமைப்பு மற்றும் தரவுத்தள இணைப்பு**

1.  **திட்ட அமைப்பு:** முந்தைய படியில் செய்தது போலவே Express, Handlebars போன்றவற்றை அமைத்தல். கூடுதலாக, `mongodb` தொகுப்பை நிறுவுதல்.
2.  **தரவுத்தள இணைப்பு:** `MongoClient`-ஐப் பயன்படுத்தி MongoDB உடன் இணைப்பை ஏற்படுத்துதல். இந்த இணைப்பை செயலி முழுவதும் பயன்படுத்த ஒரு பொதுவான கோப்பை உருவாக்குதல்.
3.  **Express உடன் ஒருங்கிணைத்தல்:** செயலி தொடங்குவதற்கு முன் தரவுத்தள இணைப்பு வெற்றிகரமாக உள்ளதா என்பதை உறுதி செய்தல்.

**Phase 2 & 3 (Admin and Content Pages)**

1.  **தரவைச் செருகுதல் (Insert):** நிர்வாகப் பக்கத்தில் இருந்து படிவத் தரவைப் பெற்று, `db.collection('crops').insertOne()` போன்ற கட்டளைகளைப் பயன்படுத்தி நேரடியாக MongoDB-ல் சேமித்தல்.
2.  **தரவைப் பெறுதல் (Find):** உள்ளடக்கப் பக்கத்தில் பயிர் விவரங்களைக் காட்ட, `db.collection('crops').find()` மற்றும் `db.collection('crops').findOne()` போன்ற கட்டளைகளைப் பயன்படுத்துதல்.
3.  **தரவைப் புதுப்பித்தல் (Update):** `db.collection('crops').updateOne()` பயன்படுத்தி இருக்கும் பயிர் விவரங்களைத் திருத்துதல்.
4.  **தரவை நீக்குதல் (Delete):** `db.collection('crops').deleteOne()` பயன்படுத்தி ஒரு பயிரை நீக்குதல்.

---

### முதல் படி: திட்டத்தை MongoDB உடன் இணைத்தல்

வாருங்கள், நமது Express செயலியை நேட்டிவ் டிரைவர் மூலம் MongoDB உடன் இணைப்போம்.

1.  **MongoDB டிரைவரை நிறுவவும்:**
    உங்கள் முனையத்தில் (terminal), `farming-website` கோப்புறையில் இருந்து இந்த கட்டளையை இயக்கவும்:
    ```bash
    npm install mongodb
    ```

2.  **தரவுத்தள இணைப்புக்கான கோப்பை உருவாக்கவும்:**
    உங்கள் திட்டத்தில் `config` என்ற புதிய கோப்புறையை உருவாக்கி, அதற்குள் `db.js` என்ற கோப்பை உருவாக்கவும். இந்த கோப்பு தரவுத்தள இணைப்பைக் கையாளும்.

    **`config/db.js`**
    ```javascript
    // MongoDB கிளையண்டை இறக்குமதி செய்யவும்
    const { MongoClient } = require('mongodb');

    // உங்கள் MongoDB இணைப்பு URL. 
    // நீங்கள் локаலில் MongoDB நிறுவியிருந்தால், இந்த URL சரியாக இருக்கும்.
    // இல்லையெனில், உங்கள் MongoDB Atlas URL ஐ இங்கே பயன்படுத்தவும்.
    const url = 'mongodb://localhost:27017';
    const client = new MongoClient(url);

    // தரவுத்தளத்தின் பெயர்
    const dbName = 'farmingDB'; 

    let db; // இந்த மாறி தரவுத்தள இணைப்பை வைத்திருக்கும்

    // தரவுத்தளத்துடன் இணைக்கும் செயல்பாடு
    const connectDB = async () => {
        try {
            // கிளையண்டைப் பயன்படுத்தி இணைக்கவும்
            await client.connect();
            console.log('MongoDB உடன் வெற்றிகரமாக இணைக்கப்பட்டது!');
            
            // தரவுத்தள αντικειμένου வரையறுக்கவும்
            db = client.db(dbName);
        } catch (err) {
            console.error('MongoDB இணைப்பு தோல்வியடைந்தது:', err);
            process.exit(1); // இணைப்பு தோல்வியுற்றால் செயலியை நிறுத்தவும்
        }
    };

    // இணைக்கப்பட்ட தரவுத்தளத்தைப் பெற ஒரு செயல்பாடு
    const getDB = () => {
        if (!db) {
            throw new Error('தரவுத்தளம் இணைக்கப்படவில்லை!');
        }
        return db;
    };

    // இந்த செயல்பாடுகளை ஏற்றுமதி செய்யவும், damit wir sie in anderen Dateien verwenden können
    module.exports = { connectDB, getDB };
    ```

3.  **`server.js` கோப்பை மாற்றி அமைக்கவும்:**
    இப்போது, நமது `server.js` கோப்பில், செயலி தொடங்குவதற்கு முன் தரவுத்தளத்துடன் இணைப்பை ஏற்படுத்துவோம்.

    **`server.js`**
    ```javascript
    const express = require('express');
    const { engine } = require('express-handlebars');
    const { connectDB, getDB } = require('./config/db'); // db.js இலிருந்து இறக்குமதி செய்யவும்

    const app = express();
    const PORT = 3000;

    // Handlebars அமைப்புகள்
    app.engine('hbs', engine({ extname: '.hbs', defaultLayout: 'main' }));
    app.set('view engine', 'hbs');
    app.set('views', './views');
    app.use(express.static('public'));

    // முகப்புப் பக்கத்திற்கான Route
    app.get('/', (req, res) => {
        // இப்போது, ஒரு மாதிரிக்காக, நாம் getDB() ஐப் பயன்படுத்தி ஒரு சேகரிப்பை அணுகலாம்
        // const db = getDB();
        // db.collection('test').insertOne({ message: "Hello from Express!" });

        res.render('home', { title: 'விவசாய வழிகாட்டி' });
    });

    // முதலில் தரவுத்தளத்துடன் இணைக்கவும், பின்னர் சேவையகத்தைத் தொடங்கவும்
    connectDB().then(() => {
        app.listen(PORT, () => {
            console.log(`Server is running at http://localhost:${PORT}`);
        });
    });
    ```

### இப்போது என்ன செய்துள்ளோம்?

1.  `mongodb` தொகுப்பை நிறுவியுள்ளோம்.
2.  `config/db.js` என்ற தனிக் கோப்பில், MongoDB உடன் இணைப்பை ஏற்படுத்துவதற்கான தர்க்கத்தை எழுதியுள்ளோம்.
3.  `server.js` இல், நமது Express செயலி தொடங்குவதற்கு *முன்பாக* `connectDB()` செயல்பாட்டை அழைத்து, தரவுத்தள இணைப்பு வெற்றிகரமாக இருப்பதை உறுதி செய்துள்ளோம்.
4.  `getDB()` என்ற செயல்பாடு மூலம், நமது செயலியின் மற்ற பகுதிகளில் (routes) இருந்து தரவுத்தளத்தை எளிதாக அணுக முடியும்.

இப்போது, நமது Express செயலி, MongoDB தரவுத்தளத்துடன் வெற்றிகரமாக இணைக்கப்பட்டுள்ளது.

**அடுத்து, நிர்வாகிக்கான (Admin) புதிய பயிரைச் சேர்க்கும் படிவத்தை (`<form>`) உருவாக்கி, அந்தத் தரவை நமது `crops` கலெக்ஷனில் `insertOne()` பயன்படுத்திச் சேமிப்பதற்கான வழிமுறைகளைச் பார்க்கலாமா?**
